# tox.ini - Testing across multiple Python versions and environments

[tox]
envlist = 
    py37,
    py38, 
    py39,
    py310,
    py311,
    py312,
    pypy3,
    lint,
    type-check,
    docs,
    coverage-report
isolated_build = true
skip_missing_interpreters = true

[testenv]
# Base configuration for all test environments
deps = 
    pytest>=6.0.0
    pytest-cov>=2.10.0
    pytest-mock>=3.6.0
    responses>=0.18.0
commands = 
    pytest {posargs:tests/}
extras = test

[testenv:py37]
# Python 3.7 specific configuration
basepython = python3.7

[testenv:py38]
# Python 3.8 specific configuration  
basepython = python3.8

[testenv:py39]
# Python 3.9 specific configuration
basepython = python3.9

[testenv:py310]
# Python 3.10 specific configuration
basepython = python3.10

[testenv:py311]
# Python 3.11 specific configuration
basepython = python3.11

[testenv:py312]
# Python 3.12 specific configuration
basepython = python3.12

[testenv:pypy3]
# PyPy3 specific configuration
basepython = pypy3

[testenv:lint]
# Code linting and formatting checks
basepython = python3.9
deps = 
    black>=22.0.0
    isort>=5.10.0
    flake8>=4.0.0
    flake8-docstrings>=1.6.0
    flake8-import-order>=0.18.1
    flake8-bugbear>=22.0.0
commands = 
    black --check --diff sendly/ tests/ examples/
    isort --check-only --diff sendly/ tests/ examples/
    flake8 sendly/ tests/ examples/

[testenv:format]
# Auto-format code (can be run manually)
basepython = python3.9
deps = 
    black>=22.0.0
    isort>=5.10.0
commands = 
    black sendly/ tests/ examples/
    isort sendly/ tests/ examples/

[testenv:type-check]
# Static type checking with mypy
basepython = python3.9
deps = 
    mypy>=0.950
    types-requests>=2.25.0
    typing-extensions>=3.7.4
commands = 
    mypy sendly/

[testenv:security]
# Security vulnerability scanning
basepython = python3.9
deps = 
    bandit>=1.7.0
    safety>=2.0.0
commands = 
    bandit -r sendly/
    safety check

[testenv:docs]
# Documentation building
basepython = python3.9
deps = 
    sphinx>=4.0.0
    sphinx-rtd-theme>=1.0.0
    myst-parser>=0.18.0
commands = 
    sphinx-build -W -b html docs/ docs/_build/html

[testenv:docs-live]
# Live documentation with auto-reload
basepython = python3.9
deps = 
    sphinx>=4.0.0
    sphinx-rtd-theme>=1.0.0
    myst-parser>=0.18.0
    sphinx-autobuild>=2021.3.14
commands = 
    sphinx-autobuild docs/ docs/_build/html --host 0.0.0.0 --port 8000

[testenv:coverage-report]
# Generate comprehensive coverage report
basepython = python3.9
deps = 
    pytest>=6.0.0
    pytest-cov>=2.10.0
    pytest-mock>=3.6.0
    responses>=0.18.0
    coverage[toml]>=6.0.0
commands = 
    pytest --cov=sendly --cov-report=html --cov-report=term-missing --cov-report=xml
    coverage report --show-missing

[testenv:integration]
# Integration tests only
basepython = python3.9
commands = 
    pytest {posargs:tests/integration/}

[testenv:unit]
# Unit tests only
basepython = python3.9
commands = 
    pytest {posargs:tests/unit/}

[testenv:examples]
# Test example scripts
basepython = python3.9
deps = 
    {[testenv]deps}
setenv = 
    SENDLY_API_KEY = sl_test_fake_key_for_examples
commands = 
    python -m py_compile examples/basic_usage.py
    python -m py_compile examples/advanced_usage.py

[testenv:build]
# Build distribution packages
basepython = python3.9
deps = 
    build>=0.8.0
    twine>=4.0.0
commands = 
    python -m build
    twine check dist/*

[testenv:performance]
# Performance testing and profiling
basepython = python3.9
deps = 
    {[testenv]deps}
    memory-profiler>=0.60.0
    line-profiler>=4.0.0
commands = 
    pytest tests/unit/test_http_client.py -v --tb=short

# Flake8 configuration
[flake8]
max-line-length = 88
extend-ignore = 
    E203,  # whitespace before ':'
    W503,  # line break before binary operator
    E501,  # line too long (handled by black)
exclude = 
    .git,
    __pycache__,
    .tox,
    .eggs,
    *.egg,
    build,
    dist,
    .venv,
    venv,
per-file-ignores = 
    __init__.py:F401  # Allow unused imports in __init__.py
    tests/*:D  # Don't require docstrings in tests

# Test discovery configuration
[pytest]
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*